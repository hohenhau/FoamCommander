/*--------------------------------*- C++ -*----------------------------------*\
  =========                 |
  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
   \\    /   O peration     | Website:  www.openfoam.org
    \\  /    A nd           | Version:  User generated
     \\/     M anipulation  |
\*---------------------------------------------------------------------------*/

FoamFile
{
    format      ascii;
    class       dictionary;
    location    "system";
    object      snappyHexMeshDict;
}

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //


// Decide which of the steps to run ---------------------------------------- //

castellatedMesh         true;   // Create basic mesh
snap                    true;   // Create mesh snapped to surfaces
addLayers               true;   // Create mesh layers on specified surfaces


// Specify OPTIONAL mesh settings ------------------------------------------ //

singleRegionName        true;   // def true  | single region surfaces named based on surface
mergePatchFaces         true;   // def true  | enables merging of coplaner cell faces
mergeAcrossPatches      false;  // def false | merging of coplanar faces on different patches
keepPatches             false;  // def false | enables removing zero sized patches


// Geometry definition (loaded from stl files) ----------------------------- //

geometry  // MANDATORY: Definition of stl files and the associate patch names
// Format: example.stl {type triSurfaceMesh; name example; file "example.stl";}
{
        // Insert the required $STL_FILES_AND_GEOMETRIES$
        // refinementBox {type searchableBox; min (0.0 0.0 0.0); max (1.0 1.0 1.0);}
};


// Settings for castellatedMesh generation  -------------------------------- //

castellatedMeshControls
{
        features  // OPTIONAL: Refinement of edges (default = {file "name.eMesh"; level 0;}
        // Format: {file "exampleFileName.eMesh"; level <refinement level>;}
        (
            // Insert the required $MESH_FEATURES$
        );

        refinementSurfaces  // MANDATORY: Definition and refinement of surfaces
        // Format: patchName {level (0 0); patchInfo {type patchType;} }
        // Refinement levels (min max) are linked resolveFeatureAngle parameter
        {
            // Insert the required $REFINEMENT_SURFACES$
        }

    refinementRegions  // OPTIONAL: Specify additional regions to be refined
    {
        //exampleVolume {mode inside; levels ((1.0 2));}
        //exampleSurface {mode distance; levels ((0.2 2) (0.3 1));} //vane leading edge
    }


    // Refinement parameters  ---------------------------------------------- //

    maxLocalCells       10000000;    // Maximum cells per CPU core
    maxGlobalCells      100000000;   // Maximum cells aded before mesh deletion step
    minRefinementCells  10;          // Was 0 Number of bad cells allowed in refinement stages (0 = none)
    maxLoadUnbalance    0.10;        // Maximum processor load unbalance
    nCellsBetweenLevels 3;           // Was 3 | Number of buffer layers between different levels


    locationInMesh (0 0 0);    // Set (X, Y, Z) coordinates to decide which side of mesh to keep


    resolveFeatureAngle 30;           // When to use maximum refinement specified in surfaces
    allowFreeStandingZoneFaces true;  // NEEDED FOR BAFFELS | Allow zone faces that share owner & neighbour cell zone
}


// Settings for mesh snapping ---------------------------------------------- //

snapControls
{
    // Wrtie intermediate mesh steps for failure inspection
    writeFlags (writeMesh writeSnapMesh);

    nSmoothPatch 3;        // Was  3 | Patch smoothing iterations to find correspondence to surface
    tolerance 0.7;         // Was  2 | Relative distance for points to be attracted by surface feature (minimum is 1.0)
    nSolveIter 30;         // Was 30 | Number of mesh displacement relaxation iterations
    nRelaxIter 5;          // Was  5 | Maximum number of snapping relaxation iterations
    nFeatureSnapIter 10;   // Was 10 | Moprh iterations within main snapping to avoid sharp edges

    implicitFeatureSnap false;    // was false | detect features by sampling surface
    explicitFeatureSnap true;     // was true  | detect featured using castellatedMeshControls
    multiRegionFeatureSnap true;  // was false | detects features between multiple surfaces
}


// Settings for the layer addition ----------------------------------------- //

addLayersControls
{
    relativeSizes true;    // Decide if layer size is absolut or relative to nearby cells
    layers
    {
        // example{nSurfaceLayers 2; expansionRatio 1.2; finalLayerThickness 0.3; minThickness 0.1;}
        // walls{nSurfaceLayers 0;}
        // Insert the required $SURFACE_LAYERS$ (Ensure to set 0 for baffles!)
    }

    expansionRatio 1.2;          // Was 1.2   | Rate at which cell layers grow
    finalLayerThickness 0.5;     // Was 0.3   | Thickness of layer in relation to neighbour cell
    // firstLayerThickness 0.3;  // Was 0.3   | Relative thickness of wall adjacent cells
    minThickness 0.01 ;          // Was 0.1   | Minimum thickness of layer in relation to neighbour cell
    nGrow 0;                     // Was 0     | Distance to keep to a neighbour patch with no layers (0 = no distance)


    // Advanced settings for the layer addition ---------------------------- //

    featureAngle 100;              // was 100 | when not to extrude surface (0 = flat 90 = perpendicular faces
    slipFeatureAngle 30;           // was 30  | Angle above which mesh is allowed to slip at non-patch sides
    nRelaxIter 3;                  // was 3   | Max. snapping relaxation iterations (good mesh shouldnt reach this)
    nSmoothSurfaceNormals 1;       // was 1   | Smoothing iterations of surface normals
    nSmoothNormals 3;              // was 3   | Smoothing iterations of interior mesh movement direction
    nSmoothThickness 2;            // Was 2   | Smooth layer thickness over surface patches
    maxFaceThicknessRatio 0.5;     // Was 0.5 | Stop layer growth on highly warped cells
    maxThicknessToMedialRatio 0.3; // Was 0.3 | Reduce layer thickness where the cell size to medial distance is large
    minMedialAxisAngle 90;         // was 90  | Angle used to pick up medial axis points
    nBufferCellsNoExtrude 0;       // Was 0   | Gradually step down number of layers (0 = all in one go)
    nLayerIter 50;                 // was 50  | Overall max number of layer addition iterations
    // layerTerminationAngle -180; // When to attempt extruding at sharp edges (-180 = always)
}


// Generic mesh settings (Determine actions at any undoable phase) --------- //

meshQualityControls
{
    maxNonOrtho 65;             // was 65    | Max permitted non-orthogonality (set to 180 to disable)
    maxBoundarySkewness 20;     // was 20    | Max permitted boundary face skewness
    maxInternalSkewness 4;      // was 4     | Max permitted internal face skewness
    maxConcave 80;              // was 80    | Max permitted concaveness
    minFlatness 0.5;            // was 0.5   | Min ratio of projected area to actual area
    minVol -1e30;               // was -1e30 | Min cell pyramid volume (large negative number disables)
    minTetQuality 1e-30;        // was 1e-30 | Min tetrahedal quality of mesh
    minTwist 0.02;              // was 0.02  | Min face twist
    minDeterminant 0.001;       // was 0.001 | Min normalised cell determinant (1 = hex & <= 0 is illegal cell)
    minFaceWeight 0.02;         // was 0.02  | Min face interpolation weight from 0 to 0.5 (0.5 for orthogonal mesh)
    minVolRatio 0.01;           // was 0.01  | Min volume ratio to neighbour cell from 0.0 to 1.0

    // Advanced layer settings
    nSmoothScale 4;             // was 4     | number of error distribution iterations
    errorReduction 0.75;        // was 0.75  | amount to scale back displacement at error points
}


// Advanced mesh quality settings ------------------------------------------ //

debug 0;
// Note: the write tolerance needs to be higher than this.
mergeTolerance 1E-6; // Merge tolerance as a fraction of overall bounding box of initial mesh


// ************************************************************************* //
